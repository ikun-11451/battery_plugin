# 🔋 手机电量模拟插件 (Battery Plugin)

这是一个为 MoFox-Bot 设计的沉浸式角色扮演插件。它为机器人模拟了一个“手机电量”系统，让机器人像真人一样需要充电，电量低时会焦虑，没电时会“关机”。

## ✨ 核心功能

1.  **电量消耗**：
    *   机器人每次回复消息都会消耗一定电量（默认 1%）。
    *   电量数据持久化存储，重启不丢失。

2.  **智能充电**：
    *   **日程感知**：插件会读取机器人的今日日程。
    *   **LLM 智能判断**：利用 LLM 判断当前日程所在的地点是否具备充电条件（例如：“在星巴克写代码” -> ✅，“在公园跑步” -> ❌）。
    *   **自动充电**：当电量低于 30% 且处于可充电地点时，机器人会主动发起充电行为，并发送提示消息。

3.  **状态表现 (Prompt 注入)**：
    *   **电量充足**：表现正常。
    *   **正在充电**：提示正在充电中。
    *   **电量低 (<20%)**：机器人会表现出担忧，尝试寻找充电机会。
    *   **电量极低 (<10%)**：机器人会表现出极度焦虑，回复变短，并告知用户快没电了。
    *   **没电关机 (0%)**：机器人将停止回复任何消息（拦截发送），直到电量恢复。

4.  **管理命令**：
    *   提供 `/battery` 命令组用于查看状态和手动干预。

## 🛠️ 安装与配置

本插件为 MoFox-Core 标准插件，直接放入 `plugins` 目录即可加载。

### 配置文件 (`config.toml`)

插件首次运行后会自动在 `config/plugins/battery_plugin/config.toml` 生成配置文件：

```toml
[battery]
initial_level = 100       # 初始电量
consume_per_reply = 1     # 每次回复消耗的电量百分比
charge_speed = 5          # 每次充电增加的电量百分比

[keywords]
# 当 LLM 判断失败时的降级方案：如果日程包含以下关键词，则认为可以充电
charge_locations = [ "家", "公司", "办公室", "宿舍", "星巴克", "咖啡馆" ]
```

## 💻 指令说明

| 指令 | 说明 | 权限 |
| --- | --- | --- |
| `/battery status` | 查看当前电量和充电状态 | 所有人 |
| `/battery charge` | 强制开始充电（连接电源） | 所有人 |
| `/battery stop` | 停止充电（拔掉电源） | 所有人 |
| `/battery set <数值>` | 直接设置电量值（调试用） | 所有人 |

## 🤖 依赖说明

*   **LLM API**: 用于智能判断充电地点。
*   **Schedule API**: 用于获取今日日程。
*   **Storage API**: 用于保存电量状态。
*   **Prompt API**: 用于注入状态提示词。

## 📝 更新日志

### v1.0.0
*   初始版本发布。
*   实现基础电量消耗与充电逻辑。
*   接入 LLM 进行地点判断。
*   添加 Prompt 注入功能。
